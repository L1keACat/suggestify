class Suggestify{#a=!1;#b={allowDuplicates:!1,allowWhitespace:!1,arrayInput:!1,arrayDelimiter:", ",caseSensitive:!1,fallbackOption:null,maxSuggestions:3,postSelectFunction:null,selector:"suggestions",submitFunction:null,suggestOptions:[]};_options={};#c="";#d=0;#e=0;#f=null;#g=!1;#h=0;#i=null;#j=null;#k=null;#l=null;#m=t=>{this.#n(),this.#o(t)};#p=t=>this.#q(t);#r=t=>this.#o(t);constructor(t){if(this._options=structuredClone(this.#b),this.setOptions(this._options,t),this.#a&&this.#s(),!(this.#i=document.getElementById(this._options.selector)))return console.error("Suggestions plugin couldn't find an element with the specified ID"),this;if("input"===this.#i.tagName.toLowerCase())this.#l=this.#i;else if(!(this.#l=this.#i.getElementsByTagName("input")[0]))return console.error("Suggestions plugin couldn't find an input element inside the target element"),this;if(this.options.arrayInput&&" "===this.options.arrayDelimiter)return console.error("Array delimiter can't be equal to whitespace character"),this;this.#t(),this.#u(),this.#a=!0}get options(){return this._options}setOptions(t,i){i&&"object"==typeof i&&Object.entries(i).forEach(([i,e])=>{"object"!=typeof e||null===e||Array.isArray(e)?void 0!==e&&(t[i]=e):(t[i]||(t[i]={}),this.setOptions(t[i],e))})}#t(){this.#j=document.createElement("div"),this.#j.className="suggestion-wrapper",this.#k=document.createElement("ul"),this.#k.className="suggestion-list",this.#j.append(this.#k),this.#i.before(this.#j),this.#j.prepend(this.#i)}#u(){this.#l.addEventListener("input",this.#m),this.#l.addEventListener("keydown",this.#p),this.#l.addEventListener("click",this.#r),document.addEventListener("click",this.#v)}#v=t=>{this.#j.contains(t.target)||this.#w()};#x(t,i){let e=this.options.allowWhitespace?"[a-zA-Z0-9\\s-_]":"[a-zA-Z0-9-_]",s=t.slice(0,i).match(RegExp(`${e}+$`)),n=t.slice(i).match(RegExp(`^${e}+`));return[s?.[0]||"",n?.[0]||""].join("")}#y(l,o){let r=this.options.arrayDelimiter.trim(),h=l.split(r).map(t=>t.trim()).filter(t=>""!==t),a=this.#x(l,o).trim();return{word:a,index:h.findLastIndex(t=>t===a),parts:h}}#n(){this.#c=this.#l.value}#o(u){this.#k.innerHTML="",this.#e=0,this.#d=0,this.#z();let{word:c,index:p,parts:d}=this.#y(this.#l.value,this.#l.selectionStart);if(this.#f=p,this.#g=!0,this.options.allowWhitespace||-1!==this.#f||(this.#f=d.findIndex(t=>t.includes(" ")),-1===this.#f||(this.#h=d[this.#f].split(" ").findIndex(t=>t===c),d[this.#f]=d[this.#f].split(" ")[this.#h?0:1],this.#g=!1)),d=d.filter((t,i)=>!(t===c&&i===p)&&""!==t),""!==c){this.#A();let g=this.options.suggestOptions.filter(t=>this.options.caseSensitive?t.startsWith(c):t.toLowerCase().startsWith(c.toLowerCase()));this.options.allowDuplicates||(g=g.filter(t=>!d.includes(t))),0!==(g=g.slice(0,this.options.maxSuggestions)).length?(this.#d=g.length,g.forEach(t=>{let i=document.createElement("li");i.classList.add("suggestion-item");let e="<b>"+t.substring(0,c.length)+"</b>";e+=t.substring(c.length),i.addEventListener("click",i=>{this.#B(t),i.stopPropagation()}),i.innerHTML=e,this.#k.append(i)}),this.#e=1,this.#C()):this.#w()}else this.#w()}#C(v){this.#z(),-1===this.#e&&this.options.fallbackOption?(this.#l.value=this.options.fallbackOption,this.#w()):0===this.#e?(this.#l.value=this.#c,this.#A()):this.#k.children.length>0&&this.#k.children[this.#e-1].classList.add("selected")}#A(){this.#k.classList.add("visible")}#w(){this.#z(),this.#k.classList.remove("visible")}#z(){for(let S of this.#k.children)S.classList.remove("selected")}#B(m){let{parts:L}=this.#y(this.#l.value,this.#l.selectionStart);-1!==this.#f?this.#g?L[this.#f]=m:(L[this.#f]=L[this.#f].split(" ")[this.#h?0:1],L.splice(this.#f+this.#h,0,m)):L.push(m),this.#l.value=L.join(this.options.arrayDelimiter),this.#e=0,this.#w(),null!=this.options.postSelectFunction&&this.options.postSelectFunction(m),this.options.arrayInput&&(this.#l.value+=this.options.arrayDelimiter),this.#c=this.#l.value,this.#l.focus(),this.#l.scrollLeft=this.#l.scrollWidth}#q(k){let{key:w}=k;switch(w){case"ArrowUp":k.preventDefault(),this.#e>(null===this.options.fallbackOption?0:-1)&&this.#e--,this.#C(k);break;case"ArrowDown":k.preventDefault(),this.#e<this.#d&&this.#e++,this.#C(k);break;case"Enter":k.preventDefault();let f=document.getElementsByClassName("selected")[0];f?f.click():null!=this.options.submitFunction&&this.options.submitFunction()}}#s(){alert("Destroy suggestion plugin with selector #"+this.options.selector),this.#l.removeEventListener("input",this.#m),this.#l.removeEventListener("keydown",this.#p),this.#l.removeEventListener("click",this.#r),document.removeEventListener("click",this.#v),this.#j&&this.#j.parentNode&&this.#j.replaceWith(this.#i),this.#k=null,this.#j=null,this.#l=null,this.#c="",this.#d=0,this.#e=0,this.#f=null,this.#g=!1,this.#h=0,this.#a=!1}}